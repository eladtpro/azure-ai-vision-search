# Vector Image Search using Azure OpenAI with Azure AI Search
![Diagram](/assets/diagram_vector_search.png)


In this article, we dive into the core functionalities of the azure-ai-vision-search repository, focusing on the ***search*** and ***vectorize*** methods in the [function_app.py](/function_app.py) file. These methods are pivotal in integrating Azure's AI services to perform vector image searches.

## The *vectorize* Method
The *vectorize* method is responsible for converting images into vector embeddings. This process involves several steps:

#### 1. HTTP Request Handling:
* The method is triggered by a POST request containing image URLs and other metadata.  
* The request body is parsed to extract the values needed for processing.  

#### 2. Image Embedding Generation:
* The ***vectorize_images*** function is called with the extracted values. This function processes each image URL by invoking the ***vectorize_image*** helper function.  
* Within ***vectorize_image***, a SAS token is created for secure access to the image stored in Azure Blob Storage.  
* The ***get_image_embeddings*** function from the helper module generates the embeddings using Azure's Computer Vision API. The embeddings are numerical representations capturing the semantic content of the images.
#### 3. Response Construction:

* The embeddings are assembled into a response payload.  
* The response is returned as a JSON object, making the embeddings available for downstream tasks such as indexing and searching.  

By leveraging Azure's Computer Vision API, the ***vectorize*** method transforms images into vectors. These vectors are numeric representations that encapsulate the images' visual features, making them suitable for similarity searches.  

## The *search* Method
The search method facilitates image similarity searches using vectors generated by the vectorize method. Here's how it works:

#### 1. HTTP Request Handling:
* The method is triggered by a POST request containing a query string and optional parameters like *max_images*.  

#### 2. Query Processing with OpenAI:
* The provided query is refined using the ***ask_openai*** function, which interacts with Azure OpenAI. This function rephrases the query to improve search accuracy.  
* The refined query is then converted into vector embeddings using the ***generate_embeddings_text*** function. This function utilizes Azure's Computer Vision API to generate text embeddings.  

#### 3. Vector Search Execution:
* A ***VectorizedQuery*** object is created, containing the query embeddings and parameters for the search.  
* The ***search_client*** performs a vector search on the image vectors stored in the Azure AI Search index. This search identifies images whose vector embeddings are most similar to the query embeddings.  

#### 4. Result Compilation:
* The search results are compiled into a response payload. For each result, a SAS token is generated for secure access to the image.
* The response is returned as a JSON object, containing the image URLs, titles, and search scores.  

The ***search*** method integrates Azure OpenAI and Azure AI Search to perform efficient and accurate image similarity searches. By converting textual queries into vector embeddings, it ensures that the search results are relevant and precise.

## Azure Resources
The azure-ai-vision-search repository leverages several Azure services to enable vector image searches:
![Azure Resources](/assets/azure-resources.png)

## Conclusion
The ***vectorize*** and ***search*** methods in the azure-ai-vision-search repository exemplify the powerful integration of Azure's AI services. The ***vectorize*** method transforms images into vector embeddings, while the ***search*** method leverages these embeddings for similarity searches. Together, they enable a robust and efficient vector image search solution using **Azure OpenAI** and **Azure AI Search**.